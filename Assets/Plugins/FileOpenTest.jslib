mergeInto(LibraryManager.library, {
  OpenFile: function() {
    var input = document.createElement('input');
    input.type = 'file';
    input.onchange = function(event) {
      var file = event.target.files[0];
      SendMessage('WebGlHandler', 'ReceiveFileName', file.name);
      var reader = new FileReader();
      reader.onload = function(event) {
        var contents = event.target.result;
        // Convert ArrayBuffer to Base64
        var base64String = btoa(String.fromCharCode.apply(null, new Uint8Array(contents)));
        // Pass the Base64 string to Unity
        SendMessage('WebGlHandler', 'ReceiveFileData', base64String);
      };
      reader.readAsArrayBuffer(file);
    };
    input.click();
  },
  SaveFile: function(ptr, filename) {
    var data = Pointer_stringify(ptr);
    console.log(data);
    var byteCharacters = atob(decodeURIComponent(data));
    var byteNumbers = new Array(byteCharacters.length);
    for (var i = 0; i < byteCharacters.length; i++) {
      byteNumbers[i] = byteCharacters.charCodeAt(i);
    }
    var byteArray = new Uint8Array(byteNumbers);
    var blob = new Blob([byteArray], {type: 'application/octet-stream'});
    var link = document.createElement('a');
    link.href = window.URL.createObjectURL(blob);
    link.download = filename + "pbb";
    link.click();
  }
});
